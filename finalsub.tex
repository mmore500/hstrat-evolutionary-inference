\begin{filecontents*}{artificial-lifex.cls}
\input{artificial-life.cls}
\end{filecontents*}

\documentclass{artificial-lifex}

\usepackage{refcount}

\input{lib/dependencies.tex}
\input{lib/pragmaonce.tex}

\ifdefined\mydraft
  \mydraft
\fi

\defaultbibliography{bibl}
\defaultbibliographystyle{apalike-ejor}

\begin{document}

\input{text/cover.tex}

\clearpage
\newpage

\begin{bibunit}
  \doublespacing
  \input{text/body.tex}

  \input{text/acknowledgement.tex}

  \input{text/references.tex}

\end{bibunit}

\newcommand{\maybeDiscardLaterPages}{%
  \IfRefUndefinedExpandable{lst:build_tree_from_artifacts}%
    {%
      % The reference is undefined: not the final run.
      % Do nothing so that pages continue to ship out.
    }%
    {%
      % The reference is defined: we assume this is the final run.
      % Insert a hook that discards all subsequent pages.
      \AddToHook{shipout/before}{\DiscardShipoutBox}%
    }%
}

\clearpage
\let\oriwrite=\write
\def\write{\immediate\oriwrite}
\maybeDiscardLaterPages
\def\write{\immediate\oriwrite}

\newpage

\setcounter{secnumdepth}{2}
\makeatletter
\renewcommand \thesection{S\@arabic\c@section}
% \renewcommand\thetable{S\@arabic\c@table}
% \renewcommand \thefigure{S\@arabic\c@figure}
\makeatother

\begin{bibunit}
  \singlespacing

  \input{text/supplement.tex}

  % \input{text/references.tex}

\end{bibunit}

\end{document}
